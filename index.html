<script>
  /* -------- BASIC UI (same as before) -------- */
  document.getElementById('year').textContent = new Date().getFullYear();

  const header = document.getElementById("header");
  const backToTop = document.getElementById("backToTop");
  window.addEventListener("scroll", () => {
    if (window.scrollY > 80) header.classList.add("scrolled");
    else header.classList.remove("scrolled");

    if(window.scrollY > 350){
      backToTop.classList.add("show");
    }else{
      backToTop.classList.remove("show");
    }
  });

  backToTop.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  const navToggle = document.getElementById("navToggle");
  const navLinks = document.getElementById("navLinks");
  navToggle.addEventListener("click", () => {
    navLinks.classList.toggle("open");
  });

  const lb = document.getElementById("lightbox");
  const lbImg = document.getElementById("lightbox-img");
  document.querySelectorAll(".gallery img").forEach(img => {
    img.addEventListener("click", () => {
      lbImg.src = img.src;
      lb.style.display = "flex";
      lb.setAttribute("aria-hidden","false");
    });
  });
  lb.addEventListener("click", () => {
    lb.style.display = "none";
    lb.setAttribute("aria-hidden","true");
  });

  const reveals = document.querySelectorAll('.reveal');
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        entry.target.classList.add('visible');
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.15 });
  reveals.forEach(el => observer.observe(el));

  /* =====================================================
     REAL-TIME FOOTBALL FIXTURES (TOP LEAGUES ONLY)
     ===================================================== */

  // TODO: Put your real API details here
  const API_BASE = "https://v3.football.api-sports.io"; // Example for API-Football
  const API_KEY  = "YOUR_API_KEY_HERE";                 // <= replace with your key

  // Leagues: IDs below are for API-Football v3. Adjust if your provider uses other IDs.
  const leaguesConfig = [
    { name: "Premier League", id: 39,  code: "EPL"     },
    { name: "La Liga",        id: 140, code: "La Liga" },
    { name: "Serie A",        id: 135, code: "Serie A" },
    { name: "Ligue 1",        id: 61,  code: "Ligue 1" },
    { name: "UCL",            id: 2,   code: "UCL"     },
    // For KPL, set the correct league ID from your API provider
    { name: "KPL",            id: null, code: "KPL"    }
  ];

  let fixturesData = [];
  let fixturesOffset = 0;
  let currentLeague = "All";

  // Select all fixture rows defined in the HTML
  const fixtureRows = document.querySelectorAll('.fixture-row');

  async function fetchLeagueFixtures(leagueObj) {
    if (!leagueObj.id) {
      // If no ID set (e.g. KPL not configured yet), skip for now
      return [];
    }

    const today = new Date().toISOString().slice(0,10); // YYYY-MM-DD
    const url = `${API_BASE}/fixtures?date=${today}&league=${leagueObj.id}&season=2024`;

    try {
      const res = await fetch(url, {
        method: "GET",
        headers: {
          "x-apisports-key": API_KEY,     // For API-Football
          // If your provider uses something else (e.g. "X-Auth-Token"),
          // change header name + value here to match their docs.
        }
      });

      const json = await res.json();
      // For API-Football v3, fixtures are in json.response array
      const list = json.response || [];

      return list.map(item => ({
        home:   item.teams?.home?.name || "Home",
        away:   item.teams?.away?.name || "Away",
        league: item.league?.name       || leagueObj.name,
        time:   formatFixtureTime(item.fixture?.date),
        label:  item.league?.round      || "Live at Bondo Square",
        live:   item.fixture?.status?.short === "1H" ||
                item.fixture?.status?.short === "2H" ||
                item.fixture?.status?.short === "ET" ||
                item.fixture?.status?.short === "P",
        homeLogo: item.teams?.home?.logo || "logo.png",
        awayLogo: item.teams?.away?.logo || "logo.png"
      }));
    } catch (e) {
      console.error("Error loading fixtures for league:", leagueObj.name, e);
      return [];
    }
  }

  function formatFixtureTime(dateStr){
    if(!dateStr) return "Time TBC";
    const d = new Date(dateStr);
    const hours = d.getHours().toString().padStart(2,"0");
    const mins  = d.getMinutes().toString().padStart(2,"0");
    return `${d.toLocaleDateString()} • ${hours}:${mins}`;
  }

  async function loadAllFixtures() {
    fixturesData = []; // reset

    const promises = leaguesConfig.map(l => fetchLeagueFixtures(l));
    const results  = await Promise.all(promises);

    results.forEach(list => {
      fixturesData.push(...list);
    });

    // If API returns nothing (e.g. no matches today or wrong setup),
    // use a small fallback so UI is not empty.
    if(!fixturesData.length){
      fixturesData = [
        {
          home:"Arsenal", away:"Man City", league:"Premier League",
          time:"Sat • 7:30 PM", label:"Sample Super Saturday",
          live:false, homeLogo:"arsenal.png", awayLogo:"city.png"
        },
        {
          home:"Barcelona", away:"Real Madrid", league:"La Liga",
          time:"Sun • 10:00 PM", label:"Sample El Clásico Night",
          live:false, homeLogo:"barca.png", awayLogo:"madrid.png"
        },
        {
          home:"Gor Mahia", away:"AFC Leopards", league:"KPL",
          time:"Sun • 4:00 PM", label:"Sample KPL Derby",
          live:false, homeLogo:"gor.png", awayLogo:"afc.png"
        }
      ];
    }

    fixturesOffset = 0;
    renderFixtures();
    setupNextMatchCountdown();
  }

  function getFilteredFixtures(){
    if(currentLeague === "All") return fixturesData;
    const filtered = fixturesData.filter(f => f.league === currentLeague);
    return filtered.length ? filtered : fixturesData;
  }

  function renderFixtures(){
    if(!fixtureRows.length || !fixturesData.length) return;

    const source = getFilteredFixtures();

    for(let i=0;i<fixtureRows.length;i++){
      const data = source[(fixturesOffset + i) % source.length];

      const row           = fixtureRows[i];
      const homeNameEl    = row.querySelector('.home-name');
      const awayNameEl    = row.querySelector('.away-name');
      const homeLogoEl    = row.querySelector('.home-logo');
      const awayLogoEl    = row.querySelector('.away-logo');
      const timeEl        = row.querySelector('.fixture-time');
      const labelEl       = row.querySelector('.fixture-label');
      const liveContainer = row.querySelector('.live-container');

      if(homeNameEl) homeNameEl.textContent = data.home;
      if(awayNameEl) awayNameEl.textContent = data.away;
      if(homeLogoEl) homeLogoEl.src = data.homeLogo || "logo.png";
      if(awayLogoEl) awayLogoEl.src = data.awayLogo || "logo.png";
      if(timeEl)     timeEl.textContent = data.time;
      if(labelEl)    labelEl.textContent = data.label;

      if(liveContainer){
        liveContainer.innerHTML = "";
        if(data.live){
          const span = document.createElement("span");
          span.className = "live-badge";
          span.innerHTML = '<i class="fa-solid fa-circle"></i> LIVE';
          liveContainer.appendChild(span);
        }
      }
    }

    fixturesOffset = (fixturesOffset + 1) % source.length;
  }

  // League filter buttons (All / EPL / La Liga / etc.)
  const filterButtons = document.querySelectorAll('.fixtures-filters button');
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      filterButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentLeague = btn.dataset.league;
      fixturesOffset = 0;
      renderFixtures();
    });
  });

  // Auto-rotate fixtures every 10s
  setInterval(() => {
    if(fixturesData.length){
      renderFixtures();
    }
  }, 10000);

  /* -------- Rotating picture next to fixtures -------- */
  const heroImages = [
    "01.jpg","02.jpg","03.jpg","04.jpg","05.jpg",
    "06.jpg","07.jpg","08.jpg","09.jpg","10.jpg"
  ];
  let heroImgIndex = 0;
  const heroImgEl = document.getElementById("rotate-fixture-img");

  function rotateHeroImage(){
    if(!heroImgEl || !heroImages.length) return;
    heroImgEl.src = heroImages[heroImgIndex];
    heroImgIndex = (heroImgIndex + 1) % heroImages.length;
  }
  rotateHeroImage();
  setInterval(rotateHeroImage, 8000);

  /* -------- Countdown to next big match (from fixturesData[0]) -------- */
  const nextMatchNameEl  = document.getElementById("nextMatchName");
  const nextMatchTimerEl = document.getElementById("nextMatchTimer");
  let nextMatchDate = null;

  function setupNextMatchCountdown(){
    if(!fixturesData.length || !nextMatchNameEl || !nextMatchTimerEl) return;

    const mainFixture = fixturesData[0];
    nextMatchNameEl.innerHTML =
      "<strong>" + mainFixture.home + " vs " + mainFixture.away + "</strong> (" + mainFixture.league + ")";

    // If API gave us an ISO date, use it. Here we just set to 24 hours from now
    // because we don't parse the real date/time deeply. You can improve this.
    nextMatchDate = new Date();
    nextMatchDate.setHours(nextMatchDate.getHours() + 24);
  }

  function updateCountdown(){
    if(!nextMatchDate || !nextMatchTimerEl) return;

    const now = new Date().getTime();
    const distance = nextMatchDate.getTime() - now;

    if(distance <= 0){
      nextMatchTimerEl.textContent = "Kick-off happening now at Bondo Square!";
      return;
    }

    const days = Math.floor(distance / (1000*60*60*24));
    const hours = Math.floor((distance % (1000*60*60*24)) / (1000*60*60));
    const minutes = Math.floor((distance % (1000*60*60)) / (1000*60));
    const seconds = Math.floor((distance % (1000*60)) / 1000);

    nextMatchTimerEl.textContent =
      (days ? days + "d " : "") +
      (hours < 10 ? "0"+hours : hours) + "h " +
      (minutes < 10 ? "0"+minutes : minutes) + "m " +
      (seconds < 10 ? "0"+seconds : seconds) + "s";
  }
  setInterval(updateCountdown, 1000);

  // Finally: load everything
  loadAllFixtures();
</script>
